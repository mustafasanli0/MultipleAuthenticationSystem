<div class="content-wrapper">

    <!-- Main content -->
    <section class="content text-center">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <h4>Add New User</h4>
            </div>


            <!-- /.container-fluid -->

        </section>

        <form id="add_user_form" method="GET" class="steps" accept-charset="UTF-8" enctype="multipart/form-data" novalidate="">
            <ul id="progressbar">
                <li class="active">Set a username</li>
                <li>User Information</li>
                <li>Photo</li>
                <li>Card</li>
                <li>Finger Print</li>
                <li>Authorization</li>


            </ul>



            <!-- USER INFORMATION FIELD SET -->
            <fieldset>
                <h2 class="fs-title">User Name Information</h2>
                <h3 class="fs-subtitle">Please Set a Username</h3>
                <div class="hs_firstname field hs-form-field">

                    <label for="firstname-99a6d115-5e68-4355-a7d0-529207feb0b3_2983">User Name? *</label>

                    <input id="firstname-99a6d115-5e68-4355-a7d0-529207feb0b3_2983" name="username" required="required" type="text" value="" placeholder="" data-rule-required="true" data-msg-required="Required">
                    <input style="display: none;" name="user_id">
                    <span class="error1" style="display: none;">
                        <i class="error-log fa fa-exclamation-triangle"></i>
                    </span>
                </div>




                <!-- End Total Number of Constituents in Your Database Field -->
                <input type="button" data-page="1" name="next" class="next action-button" value="Next" />
            </fieldset>



            <!-- User Information FIELD SET -->
            <fieldset>
                <h2 class="fs-title">User Information</h2>
                <h3 class="fs-subtitle">Basic User Information ?</h3>
                <!-- Begin Total Number of Donors in Year 1 Field -->
                <div class="form-item webform-component webform-component-textfield hs_total_number_of_donors_in_year_1 field hs-form-field" id="webform-component-acquisition--amount-1">

                    <label for="edit-submitted-acquisition-amount-1 total_number_of_donors_in_year_1-99a6d115-5e68-4355-a7d0-529207feb0b3_6344">Name? *</label>

                    <input id="edit-submitted-acquisition-amount-1" class="form-text hs-input" name="name" required="required" size="60" maxlength="128" type="text" value="" placeholder="" data-rule-required="true" data-msg-required="Required">
                    <span class="error1" style="display: none;">
                        <i class="error-log fa fa-exclamation-triangle"></i>
                    </span>
                </div>
                <!-- End Total Number of Donors in Year 1 Field -->

                <!-- Begin Total Number of Donors in Year 2 Field -->
                <div class="form-item webform-component webform-component-textfield hs_total_number_of_donors_in_year_2 field hs-form-field" id="webform-component-acquisition--amount-2">

                    <label for="edit-submitted-acquisition-amount-2 total_number_of_donors_in_year_2-99a6d115-5e68-4355-a7d0-529207feb0b3_6344">Surname? *</label>

                    <input id="edit-submitted-acquisition-amount-2" class="form-text hs-input" name="surname" required="required" size="60" maxlength="128" type="text" value="" placeholder="" data-rule-required="true" data-msg-required="Required">
                    <span class="error1" style="display: none;">
                        <i class="error-log fa fa-exclamation-triangle"></i>
                    </span>
                </div>
                <!-- End Total Number of Donors in Year 2 Field -->

                <!-- Begin Calc of Total Number of Donors Fields -->
                <!-- THIS FIELD IS NOT EDITABLE | GRAYED OUT -->
                <div class="form-item webform-component webform-component-textfield webform-container-inline hs_total_donor_percent_change field hs-form-field">

                    <label for="edit-submitted-acquisition-percent-change total_donor_percent_change-99a6d115-5e68-4355-a7d0-529207feb0b3_6344">Phone</label>
                    <input id="edit-submitted-acquisition-percent-change" class="form-text hs-input" name="phone" required="required" size="60" maxlength="128" type="text" value="" placeholder="" data-rule-required="true" data-msg-required="Required">

                </div>
                <!-- End Calc of Total Number of Donors Fields -->
                <input type="button" data-page="2" name="previous" class="previous action-button" value="Previous" />
                <input type="button" data-page="2" name="next" class="next action-button" value="Next" />
            </fieldset>



            <!-- Cultivation FIELD SET -->
            <fieldset>
                <h2 class="fs-title">Photo</h2>
                <h3 class="fs-subtitle">Take a User Photo?</h3>

                <img id="take_photo" class="img-fluid" src="">
                <input style="display: none;" id="photo_name" name="photo_name">
                <br>
                <i onclick="takePhoto()" class="fa fa-camera fa-4x text-info" aria-hidden="true"></i>

                <!-- End Average Gift Size Perchent Change Field -->
                <hr>
                <input type="button" data-page="3" name="previous" class="previous action-button" value="Previous" />
                <input id="set_photo_button" disabled type="button" data-page="3" name="next" class="next action-button" value="Next" />
            </fieldset>



            <!-- Cultivation2 FIELD SET -->
            <fieldset>
                <div class="col-md-12 col-sm-12 col-12 text-center mx-auto" style="text-align: center;/* margin: auto; */">
                    <div class="card-div info-box bg-danger text-center" style="text-align: center;">
                        <span class="info-box-icon"><i class="fa fa-credit-card"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">RFID Card</span>
                            <span class="info-box-number card-message">Please Read Your Card</span>

                            <div class="progress">
                                <div class="card-progress-bar-per" style="width: 0%"></div>
                            </div>
                            <span class="card-progress-description">Complete: 0%</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>


                <!-- End Average Gift Size Percent Change Field 2 -->
                <input type="button" data-page="4" name="previous" class="previous action-button" value="Previous" />
                <input id="rfid_card_next" disabled type="button" data-page="4" name="next" class="next action-button" value="Next" />
            </fieldset>



            <!-- RETENTION FIELD SET -->
            <fieldset>
                <div class="col-md-12 col-sm-12 col-12 text-center mx-auto" style="text-align: center;/* margin: auto; */">
                    <div class="finger-div info-box bg-danger text-center" style="text-align: center;">
                        <span class="info-box-icon"><i class="far fa-thumbs-up"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">FINGER PRINT</span>
                            <span class="info-box-number finger-message">Please Press Finger</span>

                            <div class="progress">
                                <div class="finger-progress-bar-per" style="width: 0%"></div>
                            </div>
                            <span class="finger-progress-description">Complete: 0%</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>





                <!-- End Final Calc -->
                <input type="button" data-page="5" name="previous" class="previous action-button" value="Previous" />
                <input id="finger_print_button" disabled type="button" data-page="5" name="next" class="next action-button" value="Next" />
            </fieldset>


            <fieldset>
                <h2 class="fs-title">Authorization</h2>


                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Authorization</h3>
                    </div>
                    <div id="entries" class="card-body">


                    </div>
                    <!-- /.card-body -->

                </div>


                <!-- End Final Calc -->
                <input type="button" data-page="6" name="previous" class="previous action-button" value="Previous" />
                <input onclick="userAddFormSerialize()" class="hs-button primary large action-button next" type="button" value="Submit">
            </fieldset>

            <fieldset>
                <h2 class="fs-title">Success!</h2>
                <h3 class="fs-subtitle">User Successfully Registered!</h3>
            </fieldset>
            <script src="../dist/js/user-register.js"></script>

            <script type="text/javascript">
                const getLastUserId = async() => {
                    const user_id = await eel.getLastUserId()()
                    $('input[name=user_id]').val(user_id)

                }

                getLastUserId()

                const takePhoto = async() => {
                    const userId = $('input[name=user_id]').val()


                    const photoName = await eel.setPhoto(userId)()
                    $('#take_photo').attr('src', '../user/images/' + photoName)
                    $('#photo_name').val(photoName)
                    $('#set_photo_button').prop('disabled', false)

                    await eel.startSerialRead()()
                    sendArduino()
                    getEntries()

                }
                const sendArduino = async() => {
                    const userId = $('input[name=user_id]').val()
                    await eel.sendSerialData(userId)()


                }
                const userAddFormSerialize = async() => {
                    const userdata = {}

                    $.each($('#add_user_form').serializeArray(), function(i, obj) {
                        userdata[obj.name] = obj.value
                    })

                    const response = await eel.setUserForm(userdata)()


                }

                eel.expose(cardSaved)

                function cardSaved() {
                    $('.card-div').attr('class', 'card-div info-box bg-success text-center')
                    $('.card-message').text('Rfid Card Successfully Saved')
                    $('.card-progress-bar-per').css({
                        'width': '100%',
                        'background': 'white'
                    })
                    $('.card-progress-description').text('Complete : 100%')
                    $('#rfid_card_next').prop('disabled', false)
                }
                eel.expose(setFingerMessage)

                function setFingerMessage(option) {
                    if (option == 'saved') {
                        $('.finger-div').attr('class', 'finger-div info-box bg-success text-center')
                        $('.finger-message').text('Finger Successfully Saved')
                        $('.finger-progress-bar-per').css({
                            'width': '100%',
                            'background': 'white'
                        })
                        $('.finger-progress-description').text('Complete : 100%')
                        $('#finger_print_button').prop('disabled', false)
                    } else if (option == 'remove_and_press') {
                        $('.finger-progress-bar-per').css({
                            'width': '50%',
                            'background': 'white'
                        })
                        $('.finger-progress-description').text('Complete : 50%')
                        $('.finger-message').text('Remove and Press Again')
                    }
                }

                const getEntries = async() => {
                    const entries = await eel.getEntries()()
                    console.log(entries)
                    $.each(entries, (key, data) => {


                        $('#entries').append(`<div class="row">
                            <div class="col-sm-6">
                                <!-- checkbox -->
                                <div class="form-group clearfix">

                                    <div class="icheck-primary d-inline" style="float: left;">
                                        <input name="` + data._id + `" type="checkbox" id="a` + data._id + `">
                                        <label for="a` + data._id + `">` + data.entry + `</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <!-- radio -->
                                <div class="form-group clearfix">

                                    <div class="icheck-danger d-inline" style="float: right;">
                                        <input  name="` + data._id + `-face" type="checkbox" id="b` + data._id + `">
                                        <label for="b` + data._id + `">Face</label>
                                    </div>
                                    <div class="icheck-danger d-inline" style="float: right;">
                                        <input name="` + data._id + `-card" type="checkbox" id="c` + data._id + `">
                                        <label for="c` + data._id + `" style="margin-right: 5px;">Card</label>
                                    </div>
                                    <div class="icheck-danger d-inline" style="float: right;">
                                        <input name="` + data._id + `-finger" type="checkbox" id="d` + data._id + `">
                                        <label for="d` + data._id + `" style="margin-right: 5px;">Finger</label>
                                    </div>
                                    <div class="" style="float: left;">
                                        <input name="` + data._id + `-start" style="width:100px;" class="form-control single-input" value="" placeholder="Start Time">
                                    </div>
                                    <div class="" style="float: right;">
                                        <input name="` + data._id + `-end" style="width:100px;" class="form-control single-input" value="" placeholder="End Time">
                                    </div>
                                            


                                </div>
                            </div>
                        </div>
                        <script>
    var input = $('.single-input').clockpicker({
        placement: 'bottom',
        align: 'left',
        autoclose: true,
        'default': 'now'
    });
<\/script>
                        
                        `)

                    })
                }
            </script>




</div>
<!-- /.card -->

</section>
<!-- /.content -->
</div>
<!-- /.content-wrapper -->
<link rel="stylesheet" href="../dist/css/user-register.css">
<link rel="stylesheet" href="../plugins/icheck-bootstrap/icheck-bootstrap.min.css">